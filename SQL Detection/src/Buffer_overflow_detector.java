//Here we go , God help us !
import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.HashMap;


public class Buffer_overflow_detector {

    public static void main (String args[]) throws IOException
    {  String at ;
       
        File file = new File("testt.txt");
        FileReader fileReader = new FileReader(file);
        BufferedReader bufferedReader = new BufferedReader(fileReader);
        StringBuffer stringBuffer = new StringBuffer();
        String line;
        HashMap<String,Integer> hm=new HashMap<String,Integer>();
       
        while ((line = bufferedReader.readLine()) != null)
        {
            if( line.contains("char") && line.contains("[")&&line.contains("]"))
            {
                line =line.replaceAll("\\s", "");
                 //line.delete(0,2);
                 line =line.replaceAll("char", "");
                 line =line.replaceAll("float", "");
                 line =line.replaceAll(";", "");
                 System.out.println("current line is "+line);
                 line=     line.replaceAll("]","");
                 System.out.println("the value of key is "+Integer.parseInt(line.substring(line.indexOf("[")+1)));
            int a=Integer.parseInt(line.substring(line.indexOf("[")+1));
            line=line.substring(0, line.indexOf("["));
            hm.put(line, a);
           
           
            }
           
            if(line.contains("strcpy("))
            {
                System.out.println("\ncurrent total hashmap is ");
                System.out.println(hm.toString());
                int flag =0;
                String first =line.substring(line.indexOf("(")+1, line.indexOf(","));
                String second = line.substring(line.indexOf(",")+1, line.indexOf(")"));
                if(!hm.containsKey(line.substring(line.indexOf("(")+1, line.indexOf(","))) || !hm.containsKey(line.substring(line.indexOf(",")+1, line.indexOf(")"))))
                {
                       System.out.println("memory is not assigned in advance");
                       flag=1;
                }
                int val1  = hm.get(first);
                int val2  = hm.get(second);
                if(val1< val2 && flag==0)
                {
                    System.out.println("the overflow is occuring so increase the dest memory");
                    flag=1;
                }
                      
                if((hm.containsKey(line.substring(line.indexOf("(")+1, line.indexOf(",")))
                        ||
                    hm.containsKey(line.substring(line.indexOf(",")+1, line.indexOf(")"))))
                    &&
                    flag==0)
                {
                           System.out.println("You might be at risk of buffer overflow");
                           flag=1;   
                }
                       
           
        }
       
       
    }
   
    }
    }